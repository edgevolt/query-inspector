<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Interactive query language explainer that breaks down KQL, SQL, and other queries with visual indicators and detailed explanations.">
  <meta name="keywords" content="KQL, SQL, Query Language, Kusto, Explainer, Tutorial, Learn">
  <title>Inspector - Understand Your Queries</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="header-text">
          <h1>Inspector</h1>
          <p>Analyze and understand query statements and log entries</p>
        </div>
      </div>
    </header>

    <!-- Mode Toggle -->
    <div class="mode-toggle">
      <button id="query-mode-btn" class="mode-btn active" aria-label="Switch to Statement Mode">
        üîç Statement Mode
      </button>
      <button id="log-mode-btn" class="mode-btn" aria-label="Switch to Log Mode">
        üìã Log Mode
      </button>
      <button id="regex-mode-btn" class="mode-btn" aria-label="Switch to Regex Mode">
        üî§ Regex Mode
      </button>
      <button id="email-mode-btn" class="mode-btn" aria-label="Switch to Email Mode">
        üìß Email Mode
      </button>
    </div>

    <!-- Statement Mode Container (query language parsing) -->
    <div id="query-mode-container" class="mode-container active">

      <!-- Language Selector -->
      <div class="statement-mode-header">
        <div class="statement-info">
          <h2><span id="language-name">KQL</span></h2>
          <p id="language-description">Understand your Kusto Query Language statements with visual breakdowns and
            detailed explanations</p>
        </div>
        <div class="language-selector-container">
          <label for="language-selector" class="sr-only">Select query language</label>
          <select id="language-selector" class="language-selector" aria-label="Select query language">
            <option value="kql">üìä KQL</option>
            <!-- Future languages will be added here dynamically -->
          </select>
        </div>
      </div>

      <!-- Input Section -->
      <section class="input-section">
        <label for="query-input" class="input-label" id="query-input-label">Enter your query:</label>
        <textarea id="query-input" class="query-input"
          placeholder="SecurityEvent | where TimeGenerated > ago(1h) | take 10" aria-label="Query input"></textarea>
      </section>

      <!-- Explanation Section -->
      <section class="explanation-section">
        <h2 class="input-label">Explanation:</h2>
        <div id="explanation-container" class="explanation-container">
          <div class="explanation-empty">
            Enter a KQL query above to see a detailed explanation
          </div>
        </div>

        <!-- Info Panel for selected token -->
        <div id="info-panel" class="info-panel" style="display: none;">
          <div class="info-panel-header">
            <h3 id="info-panel-title"></h3>
            <button id="info-panel-close" class="info-panel-close" aria-label="Close info panel">√ó</button>
          </div>
          <div id="info-panel-content"></div>
        </div>
      </section>

      <!-- Examples Section -->
      <section class="examples-section">
        <h2 class="examples-title">Example Queries</h2>
        <div class="examples-grid" id="examples-grid">
          <!-- Examples will be populated by JavaScript -->
        </div>
      </section>
    </div> <!-- End Query Mode Container -->

    <!-- Log Mode Container (new functionality) -->
    <div id="log-mode-container" class="mode-container">
      <section class="log-header">
        <h2>üìã Log Parser</h2>
        <p>Paste firewall logs, server logs, or security events to analyze</p>
      </section>

      <section class="log-controls">
        <label for="log-format-selector" class="input-label">Log Format:</label>
        <div class="log-controls-row">
          <select id="log-format-selector" class="log-format-selector">
            <option value="">Select log format...</option>
          </select>
          <button id="auto-detect-btn" class="auto-detect-btn">üîç Auto-Detect</button>
        </div>
      </section>

      <section class="log-input-section">
        <label for="log-input" class="input-label">Paste Log Entries:</label>
        <textarea id="log-input" class="log-input"
          placeholder="Paste your log entries here (one or multiple lines)..."></textarea>
      </section>

      <!-- Color Legend -->
      <section class="log-color-legend">
        <details>
          <summary class="legend-title">üé® Field Category Colors</summary>
          <div class="legend-content">
            <div class="legend-item">
              <span class="legend-color" style="background: #3b82f6;"></span>
              <span class="legend-label"><strong>Blue</strong> - Source information (IP, port, zone, user,
                device)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #10b981;"></span>
              <span class="legend-label"><strong>Green</strong> - Destination information (IP, port, zone, user,
                device)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #ef4444;"></span>
              <span class="legend-label"><strong>Red</strong> - Security & threats (malware, attacks, severity)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #f59e0b;"></span>
              <span class="legend-label"><strong>Orange</strong> - Actions & policy (allow, deny, rule names)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #8b5cf6;"></span>
              <span class="legend-label"><strong>Purple</strong> - Policy & rules (policy ID, rule UUID)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #06b6d4;"></span>
              <span class="legend-label"><strong>Cyan</strong> - Timestamps (receive time, generated time)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #84cc16;"></span>
              <span class="legend-label"><strong>Lime</strong> - Protocol & network (TCP, UDP, ports, flags)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #ec4899;"></span>
              <span class="legend-label"><strong>Pink</strong> - Traffic statistics (bytes, packets, duration)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #6b7280;"></span>
              <span class="legend-label"><strong>Gray</strong> - General fields (device name, application, other)</span>
            </div>
          </div>
        </details>
      </section>

      <section class="log-results-section">
        <h3 class="input-label">Parsed Fields:</h3>
        <div id="parsed-fields-container" class="parsed-fields-container"></div>
      </section>

      <section class="log-statistics-section" style="display: none;">
        <h3 class="input-label">Statistics:</h3>
        <div id="log-statistics-container" class="log-statistics-container"></div>
      </section>

      <section class="log-examples-section">
        <h3 class="examples-title">Example Logs</h3>
        <div id="log-examples-grid" class="examples-grid"></div>
      </section>
    </div> <!-- End Log Mode Container -->

    <!-- Regex Mode Container -->
    <div id="regex-mode-container" class="mode-container">
      <section class="regex-header">
        <h2>üî§ Regex Parser</h2>
        <p>Build, test, and understand regular expressions with interactive explanations</p>
      </section>

      <section class="regex-pattern-section">
        <label for="regex-pattern-input" class="input-label">Regular Expression Pattern:</label>
        <textarea id="regex-pattern-input" class="regex-pattern-input"
          placeholder="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"></textarea>

        <div class="regex-flags-container">
          <label class="input-label">Flags:</label>
          <div class="regex-flags">
            <label class="flag-checkbox"
              title="Case Insensitive: Makes the pattern match regardless of letter case. Example: /hello/i matches 'Hello', 'HELLO', 'hello'">
              <input type="checkbox" id="flag-i">
              <span class="flag-label">i</span>
              <span class="flag-description">Case Insensitive</span>
            </label>
            <label class="flag-checkbox"
              title="Global: Find all matches in the string, not just the first one. Example: /a/g finds all 'a' characters">
              <input type="checkbox" id="flag-g" checked>
              <span class="flag-label">g</span>
              <span class="flag-description">Global</span>
            </label>
            <label class="flag-checkbox"
              title="Multiline: Makes ^ and $ match line breaks. Example: /^line/m matches 'line' at the start of any line">
              <input type="checkbox" id="flag-m">
              <span class="flag-label">m</span>
              <span class="flag-description">Multiline</span>
            </label>
            <label class="flag-checkbox"
              title="Dotall: Makes . match newline characters. Example: /a.b/s matches 'a\nb'">
              <input type="checkbox" id="flag-s">
              <span class="flag-label">s</span>
              <span class="flag-description">Dotall</span>
            </label>
            <label class="flag-checkbox"
              title="Unicode: Enables full Unicode support. Required for \p{}, emoji, and characters beyond Basic Latin">
              <input type="checkbox" id="flag-u">
              <span class="flag-label">u</span>
              <span class="flag-description">Unicode</span>
            </label>
            <label class="flag-checkbox"
              title="Sticky: Matches only at the exact position (lastIndex). Useful for parsers and tokenizers">
              <input type="checkbox" id="flag-y">
              <span class="flag-label">y</span>
              <span class="flag-description">Sticky</span>
            </label>
          </div>
        </div>
      </section>

      <section class="regex-breakdown-section">
        <h3 class="input-label">Pattern Breakdown:</h3>
        <div id="regex-breakdown-container" class="regex-breakdown-container">
          <div class="explanation-empty">Enter a regex pattern above to see a detailed breakdown</div>
        </div>
      </section>

      <!-- Color Legend -->
      <section class="regex-color-legend">
        <details>
          <summary class="legend-title">üé® Color Guide</summary>
          <div class="legend-content">
            <div class="legend-item">
              <span class="legend-color" style="background: #0066cc;"></span>
              <span class="legend-label"><strong>Blue</strong> - Character classes & sets (<code>\d</code>,
                <code>[a-z]</code>)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #7c3aed;"></span>
              <span class="legend-label"><strong>Purple</strong> - Groups & captures (<code>(...)</code>,
                <code>(?&lt;name&gt;...)</code>)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #dc2626;"></span>
              <span class="legend-label"><strong>Red</strong> - Quantifiers (<code>*</code>, <code>+</code>,
                <code>?</code>, <code>{2,5}</code>)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #059669;"></span>
              <span class="legend-label"><strong>Green</strong> - Anchors & boundaries (<code>^</code>, <code>$</code>,
                <code>\b</code>)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #6b7280;"></span>
              <span class="legend-label"><strong>Gray</strong> - Alternation & operators (<code>|</code>)</span>
            </div>
          </div>
        </details>
      </section>

      <!-- Info Panel for token explanations -->
      <section class="regex-info-section" style="display: none;">
        <div id="regex-info-panel" class="info-panel">
          <div class="info-panel-header">
            <h3 id="regex-info-panel-title"></h3>
            <button id="regex-info-panel-close" class="info-panel-close" aria-label="Close info panel">√ó</button>
          </div>
          <div id="regex-info-panel-content"></div>
        </div>
      </section>

      <section class="regex-test-section">
        <label for="regex-test-input" class="input-label">Test String:</label>
        <textarea id="regex-test-input" class="regex-test-input"
          placeholder="Enter text to test your regex pattern..."></textarea>
      </section>

      <section class="regex-matches-section" style="display: none;">
        <h3 class="input-label">Matches:</h3>
        <div id="regex-matches-container" class="regex-matches-container"></div>

        <div id="regex-match-stats" class="regex-match-stats"></div>
      </section>

      <section class="regex-groups-section" style="display: none;">
        <h3 class="input-label">Capture Groups:</h3>
        <div id="regex-groups-container" class="regex-groups-container"></div>
      </section>

      <section class="regex-examples-section">
        <h3 class="examples-title">Example Patterns</h3>
        <div id="regex-examples-grid" class="examples-grid"></div>
      </section>

      <section class="regex-cheatsheet-section">
        <details class="regex-cheatsheet">
          <summary class="cheatsheet-title">üìö Regex Cheat Sheet</summary>
          <div id="regex-cheatsheet-content" class="cheatsheet-content"></div>
        </details>
      </section>
    </div> <!-- End Regex Mode Container -->

    <!-- Email Mode Container -->
    <div id="email-mode-container" class="mode-container">
      <section class="email-header">
        <h2>üìß Email Header Parser</h2>
        <p>Parse and analyze SMTP email headers with RFC 5322/5321 compliance</p>
      </section>

      <section class="email-input-section">
        <label for="email-input" class="input-label">Paste Email Headers:</label>
        <textarea id="email-input" class="email-input"
          placeholder="Paste email headers here (From:, To:, Subject:, Received:, etc.)..."></textarea>
      </section>

      <section class="email-routing-section" style="display: none;">
        <h3 class="input-label">üì¨ Email Routing Path:</h3>
        <div id="email-routing-container" class="email-routing-container"></div>
      </section>

      <!-- Color Legend for Header Categories -->
      <section class="email-color-legend">
        <details>
          <summary class="legend-title">üé® Header Category Colors</summary>
          <div class="legend-content">
            <div class="legend-item">
              <span class="legend-color" style="background: #3b82f6;"></span>
              <span class="legend-label"><strong>Blue</strong> - Source information (From, Sender, Reply-To)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #10b981;"></span>
              <span class="legend-label"><strong>Green</strong> - Destination (To, Cc, Bcc)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #f59e0b;"></span>
              <span class="legend-label"><strong>Orange</strong> - Timestamp (Date, Received)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #8b5cf6;"></span>
              <span class="legend-label"><strong>Purple</strong> - Routing (Message-ID, References, In-Reply-To)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #ec4899;"></span>
              <span class="legend-label"><strong>Pink</strong> - Content (Subject, Content-Type, MIME-Version)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #ef4444;"></span>
              <span class="legend-label"><strong>Red</strong> - Security (DKIM, SPF, DMARC,
                Authentication-Results)</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #6b7280;"></span>
              <span class="legend-label"><strong>Gray</strong> - Metadata (X-Mailer, Priority, List-* headers)</span>
            </div>
          </div>
        </details>
      </section>

      <section class="email-results-section">
        <h3 class="input-label">üìã Parsed Headers:</h3>
        <div id="parsed-headers-container" class="parsed-headers-container"></div>
      </section>

      <section class="email-examples-section">
        <h3 class="examples-title">Example Email Headers</h3>
        <div id="email-examples-grid" class="examples-grid"></div>
      </section>
    </div> <!-- End Email Mode Container -->

    <!-- Footer -->
    <footer class="footer">
      <p>
        <strong>explain.getstat.dev</strong> - Learn query languages interactively
      </p>
    </footer>
  </div>

  <script type="module" src="main.js?v=14"></script>
</body>

</html>